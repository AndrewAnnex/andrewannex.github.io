<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.3.0"><meta name=author content="Annex, A.M."><meta name=description content="Although SpiceyPy is my largest public python package, this blog post will be about two smaller, but conceptually important projects that I have started that I think present some interesting concepts for the planetary science community.
Both of these tools are Command Line Interfaces (CLIs) that are built upon the excellent python package &ldquo;python-fire&rdquo;. Fire is able to produce a rich command line utility from the existing functions in a python file or class, with essentially no additional code other than the import for fire and a single function call."><link rel=alternate hreflang=en-us href=https://andrewannex.github.io/post/moody-and-circ/><meta name=theme-color content="hsl(27, 48%, 68%)"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.6.0/css/all.css integrity=sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css crossorigin=anonymous title=hl-light disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css crossorigin=anonymous title=hl-dark><link rel=stylesheet href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono"><link rel=stylesheet href=/css/academic.min.a2da4865615564aeadb4a89a86edddfb.css><link rel=stylesheet href=/css/academic.fa342957495a01caef8d0a0bb6f01857.css><link rel=manifest href=/site.webmanifest><link rel=icon type=image/png href=/img/icon.png><link rel=apple-touch-icon type=image/png href=/img/icon-192.png><link rel=canonical href=https://andrewannex.github.io/post/moody-and-circ/><meta property=twitter:card content=summary><meta property=twitter:site content=@AndrewAnnex><meta property=twitter:creator content=@AndrewAnnex><meta property=og:site_name content=※><meta property=og:url content=https://andrewannex.github.io/post/moody-and-circ/><meta property=og:title content="Moody and Circ | ※"><meta property=og:description content="Although SpiceyPy is my largest public python package, this blog post will be about two smaller, but conceptually important projects that I have started that I think present some interesting concepts for the planetary science community.
Both of these tools are Command Line Interfaces (CLIs) that are built upon the excellent python package &ldquo;python-fire&rdquo;. Fire is able to produce a rich command line utility from the existing functions in a python file or class, with essentially no additional code other than the import for fire and a single function call."><meta property=og:image content=https://andrewannex.github.io/img/icon-192.png><meta property=og:locale content=en-us><meta property=article:published_time content=2018-01-07T16:53:33-05:00><meta property=article:modified_time content=2018-01-07T16:53:33-05:00><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css><script src=//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js></script><script>window.addEventListener("load",function(){window.cookieconsent.initialise({"palette":{"popup":{"background":"hsl(27, 48%, 68%)","text":"#fff"},"button":{"background":"#fff","text":"hsl(27, 48%, 68%)"}},"theme":"classic","content":{"message":"This website uses cookies to ensure you get the best experience on our website.","dismiss":"Got it!","link":"Learn more","href":"https://cookies.insites.com"}})});</script><title>Moody and Circ | ※</title></head><body id=top data-spy=scroll data-target=#TableOfContents data-offset=71 class=dark><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off role=textbox spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id=navbar-main><div class=container><a class=navbar-brand href=/><img src=/img/icon-192.png alt=※></a>
<button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav mr-auto"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#publications><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul><ul class="navbar-nav ml-auto"><li class=nav-item><a class="nav-link js-search" href=#><i class="fas fa-search" aria-hidden=true></i></a></li><li class=nav-item><a class="nav-link js-dark-toggle" href=#><i class="fas fa-moon" aria-hidden=true></i></a></li></ul></div></div></nav><article class=article itemscope itemtype=http://schema.org/Article><div class="article-container pt-3"><h1 itemprop=name>Moody and Circ</h1><meta content="2018-01-07 16:53:33 -0500 EST" itemprop=datePublished><meta content="2018-01-07 16:53:33 -0500 EST" itemprop=dateModified><div class=article-metadata><span class=article-date><time>Jan 7, 2018</time></span>
<span class=middot-divider></span><span class=article-reading-time>5 min read</span></div></div><div class=article-container><div class=article-style itemprop=articleBody><p>Although <a href=https://github.com/AndrewAnnex/SpiceyPy target=_blank>SpiceyPy</a> is my largest public python package, this blog post will be about
two smaller, but conceptually important projects that I have started that I think
present some interesting concepts for the planetary science community.</p><p>Both of these tools are Command Line Interfaces (CLIs) that are built upon the excellent python package <a href=https://github.com/google/python-fire target=_blank>&ldquo;python-fire&rdquo;</a>. Fire is able to produce a rich command line utility from the existing functions in a python file or class, with essentially no additional code other than the import for fire and a single function call. Fire also grants you options like dropping into a REPL and tab completion. This from my view would be sufficient for most use cases I have and have seen. Alternatives like <a href=https://docs.python.org/3/library/argparse.html target=_blank>&ldquo;argparse&rdquo;</a> which is built-in to python requires a lot more work and another package called <a href=http://click.pocoo.org/5/ target=_blank>&ldquo;click&rdquo;</a> is popular I just do not need access to the additional functionality. In short, I am able to write functions into a class and directly expose them with fire with essentially no additional code, and after uploading to pypi users can get access to this functionality in their terminals or use the same code as a python package.</p><h3 id=moody>Moody</h3><p>The first tool, <a href=https://github.com/AndrewAnnex/moody target=_blank>&ldquo;moody&rdquo;</a>, provides a minimal interface to the Mars ODE REST api through the command line so that simple meta-data queries and provides commands to download HiRISE and CTX EDR images by partial product id. While HiRISE EDR products consist of several .IMG files, they are relatively easy to download using wget. In moody the command would look like:</p><pre><code class=language-bash>moody hirise-edr PSP_001810_1825*
</code></pre><p>However CTX images are not able to be downloaded using the same trick as they are separated by data volumes, but by using the ODE I am able to query for the correct url without much work. Meta-data can be easily retrieved by running:</p><pre><code class=language-bash>moody get-ctx-meta P19_008442_1899*
</code></pre><p>And if I am only interested in a single field the emission angle can be retrieved by:</p><pre><code class=language-bash>moody get-ctx-meta-by-key P19_008442_1899*  Emission_angle
</code></pre><p>At the moment, the functionality for moody is fairly use-case focused, but my hope is that it will grow as more meta-data query use-cases are contributed. In any case, for users that want to perform programatic queries to the ODE, moody provides a template to build upon. My hope is that this tool will be useful for people who know a hirise or ctx product id, but just need to do quick lookups of meta-data without opening a web browser and having to click and scroll some page for the info.</p><h3 id=circ>Circ</h3><p>My newest tool, <a href=https://github.com/AndrewAnnex/circ target=_blank>&ldquo;Circ&rdquo;</a>, attempts to construct reasonable mosaics using CTX images over a provided bounding box. This came out of a need to look at large areas of Mars where the existing CTX mosaic in Google Earth does not cover. It currently does this by first selecting the CTX images that intersect the user provided bounding box, and then selects images with low emission angles (which is configurable by the user). This is what the command looks like:</p><pre><code class=language-bash>circ make-vrt 136.0 -7.0 139.5 -3.5 --name gale --em_tol 1.0
</code></pre><p>Here I am making a mosaic over Gale crater and I am limiting the emission angles to be no greater than 1.0 degrees to keep things consistently nadir.</p><p>Then the collection is sorted by emission angle and area, and the foot prints are then intersected in a cascade operation so that footprints that almost completely overlap previous footprints are excluded. This reduces the total number of images needed to cover the area to a high degree, and then a similar reduction is then performed by stochastically sampling the collection to further reduce the number of images needed. This is a cheap way to get to good-enough results to what I think is something similar to a packing problem that I am sure is more elegantly solved elsewhere, but from what I have tested so far this works pretty well.</p><p>Once the minimal set of images have been selected, the pre-computed pyramided geotiffs provided by the <a href=https://viewer.mars.asu.edu/viewer/ctx target=_blank>&ldquo;ASU Mars Space Flight Facility&rdquo;</a> are then downloaded in parallel to a folder, and a GDAL VRT is built from the tiffs in that folder. In brief, VRTs are xml files that can point to multiple data sources readable by GDAL that can be local or remote, and then gdal treats the resulting vrt file as a single data source that can then be read directly by other GDAL powered applications like QGIS. For more on VRTs <a href=http://www.paolocorti.net/2012/03/08/gdal_virtual_formats/ target=_blank>this blog post</a> explains it with more detail. This results in an instant mosaic that can be viewed in QGIS, and then further gdal operations can create a single flat geotiff mosaic to save disk space. Here is a zoom in to the gale mosaic I made using the circ command above displayed in QGIS overlaying the MOLA shaded-colorized topography map:</p><p><img class=pure-img src=/img/gale_circ_vrt.jpg alt="Gale Mosaic from VRT created by circ"></img></p><p>As you can see there is a pretty large gap by the Dulce Vallis and Farah Vallis markers, looking at the available images it looks like an image with an emission angle of around 2 degrees was excluded, but this is because I asked for images with equal to or less than 1 degree. Otherwise the results are usable. And of course if you needed to add an image to a VRT or remove one, you would simply update the folder containing all of the downloaded geotiffs and re-run gdalbuildvrt. A thing that is missing from Circ at the moment is the ability to histogram match the images to make the overlaps less obvious, but that is something I hope can either be contributed or eventually I will get to it if there is not some other existing utility or function in QGIS or gdal that can do it.</p><h2 id=conclusion>Conclusion</h2><p>In my first long blog post, I have discussed two CLI tools I have built for the martians of the planetary science community. I hope they prove to be useful! At the top I alluded to there being interesting concepts for the planetary community, and if I had not made it clear then I should say that it would be a great thing if more members and made their work available in command line tools. Spending a little time to polish them up makes these utilities better for your own use and will benefit the community as a whole if they are made available.</p></div><div class="media author-card" itemscope itemtype=http://schema.org/Person><img class="portrait mr-3" src="https://s.gravatar.com/avatar/b4f34e60edc9cc4e40f868ba708f8ae2?s=200')" itemprop=image alt=Avatar><div class=media-body><h5 class=card-title itemprop=name><a href=/authors/admin/>Annex, A.M.</a></h5><h6 class=card-subtitle>Ph.D. Student</h6><p class=card-text itemprop=description>My research interests include the applications of deep learning to planetary geology.</p><ul class=network-icon aria-hidden=true><li><a itemprop=sameAs href=https://twitter.com/AndrewAnnex target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a itemprop=sameAs href=https://github.com/AndrewAnnex target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a itemprop=sameAs href=https://linkedin.com/in/AndrewAnnex target=_blank rel=noopener><i class="fab fa-linkedin-in"></i></a></li></ul></div></div></div></article><div class=container><footer class=site-footer><p class=powered-by>2020 &middot;
Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# id=back_to_top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&times;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div><script src=/js/mathjax-config.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin=anonymous></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin=anonymous async></script><script>hljs.initHighlightingOnLoad();</script><script>const search_index_filename="/index.json";const i18n={'placeholder':"Search...",'results':"results found",'no_results':"No results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks"};</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/academic.min.3258b3a711acd6208568ec000de4beec.js></script></body></html>